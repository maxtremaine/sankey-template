

<!DOCTYPE html>
<html><head>
<script defer="">
    document.addEventListener('DOMContentLoaded', () => {
        const [col1, col2, col3, col4] = [20, 155, 290, 425] 
        const relativeToRevenue = relativeBoxHeight(75, 100) 

        Account('Subscriptions', '$45M')
            .position(col1, 25)
            .size(relativeToRevenue(45))
            .addLine(col1 + 30, 72, col2, 97)
            .render();
        Account('Services', '$26M')
            .position(col1, 126)
            .size(relativeToRevenue(26))
            .addLine(col1 + 30, 160.4, col2, 144.4)
            .render();
        Account('Merch', '$7M')
            .position(col1, 200)
            .size(relativeToRevenue(7))
            .lineSize(5)
            .addLine(col1 + 30, 219.5, col2, 164.3)
            .render();
        Account('Refunds', '$3M')
            .red()
            .position(col2, 190)
            .size(relativeToRevenue(3))
            .addLine(col1 + 30, 224.2, col2, 209)
            .render()
        Account('Revenue', '$75M')
            .position(col2, 50)
            .size(100)
            .render()
        Account('Variable Cloud', '$15M')
            .red()
            .position(col3, 25)
            .size(relativeToRevenue(15))
            .addLine(col2 + 30, 77, col3, 52)
            .render()
        Account('Support', '$1M')
            .red()
            .position(col3, 85)
            .size(relativeToRevenue(1))
            .addLine(col2 + 30, 87.4, col3, 102.6)
            .render()
        Account('Gross Profit', '$59M')
            .position(col3, 125)
            .size(relativeToRevenue(59))
            .addLine(col2 + 30, 127.5, col3, 181.4)
            .render()
        Account('Marketing', '$15M')
            .red()
            .position(col4, 25)
            .size(relativeToRevenue(15))
            .addLine(col3 + 30, 152, col4, 52)
            .render()
        Account('Development', '$8M')
            .red()
            .position(col4, 80)
            .size(relativeToRevenue(8))
            .addLine(col3 + 30, 167.2, col4, 102.3)
            .render()
        Account('Administration', '$1M')
            .red()
            .position(col4, 126)
            .size(relativeToRevenue(1))
            .addLine(col3 + 30, 173.2, col4, 143.7)
            .render()
        Account('EBITDA', '$35M')
            .position(col4, 165)
            .size(relativeToRevenue(35))
            .addLine(col3 + 30, 197.3, col4, 205.5)
            .render()
    });
</script>
<style>
    svg { border: 1px solid black; }
</style>
</head>
<body>
<svg viewBox="0 0 500 250" xmlns="http://www.w3.org/2000/svg">
<style>
    text { font-size: 10px; }
    text.value { fill: grey; }
    rect.green { fill: green; }
    rect.red { fill: red; }
    path { fill: none; }
    path.green { stroke: LightGreen; }
    path.red { stroke: LightPink; }
</style>
</svg>
<script>
    const relativeBoxHeight = (baseValue, baseHeight) => (value) => value / baseValue * baseHeight 

    function Account(label, value) {
        this.label = label
        this.value = value
        this.x = 20
        this.y = 20
        this.width = 30
        this.boxHeight = 1
        this.lineHeight = 1
        this.class = "green"
        this.x1 = null
        this.y1 = null
        this.x2 = null
        this.y2 = null

        if(!new.target) {
             return new Account(label, value)
        }
    }

    Account.prototype.position = function(x, y) {
        this.x = x
        this.y = y
        return this
    }

    Account.prototype.size = function(height) {
        this.boxHeight = height
        this.lineHeight = height
        return this
    }

    Account.prototype.lineSize = function(height) {
        this.lineHeight = height
        return this
    } 

    Account.prototype.red = function() {
        this.class = 'red'
        return this
    } 

    Account.prototype.addLine = function(x1, y1, x2, y2) {
        this.x1 = x1
        this.y1 = y1
        this.x2 = x2
        this.y2 = y2
        return this
    }

    Account.prototype.render = function() {
        const spec = "http://www.w3.org/2000/svg";
        const diagram = document.querySelector('svg')

        const label = document.createElementNS(spec, "text")
        label.setAttribute('x', this.x)
        label.setAttribute('y', this.y)
        label.setAttribute('class', 'label')
        label.appendChild(document.createTextNode(this.label))
        diagram.appendChild(label)

        const value = document.createElementNS(spec, "text")
        value.setAttribute('x', this.x)
        value.setAttribute('y', this.y + 12)
        value.setAttribute('class', 'value')
        value.appendChild(document.createTextNode(this.value))
        diagram.appendChild(value)

        const box = document.createElementNS(spec, "rect")
        box.setAttribute('x', this.x)
        box.setAttribute('y', this.y + 17)
        box.setAttribute('width', this.width)
        box.setAttribute('height', this.boxHeight)
        box.setAttribute('class', this.class)
        diagram.appendChild(box)

        if(![this.x1, this.x2, this.y1, this.y2].includes(null)) {
            const line = document.createElementNS(spec, 'path')
            const [x1, y1, x2, y2] = [this.x1, this.y1, this.x2, this.y2]
            const xMid = x2 - (x2 - x1) / 2
            line.setAttribute('d', `M ${x1},${y1} C ${xMid},${y1} ${xMid},${y2} ${x2},${y2}`)
            line.setAttribute('stroke-width', this.lineHeight)
            line.setAttribute('class', this.class)
            diagram.appendChild(line)
        }

        return this
    }
</script>
</body></html>
